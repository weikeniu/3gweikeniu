$.fn.extend({ uiImageGallery: function (g) { if (!g) { return } var b; var f = $(this); var d = $("<div>").addClass("uiimagegallery_scroll").attr("id", $(this).attr("id") + "_imgScroll"); var e = $("<ul>"); d.prependTo(f); e.appendTo(d); var a = new iScroll($(this).attr("id") + "_imgScroll", { snap: true, zoom: false, momentum: false, hScrollbar: false, onScrollEnd: function () { var h = e.find("img[data-index='" + a.currPageX + "']"); var i; f.attr("currentPage", a.currPageX); if (h.attr("src").indexOf("loader.gif") != -1) { h.css("visibility", "hidden"); h.bind("load", function () { i = { height: h.height(), width: h.width() }; if (i.width > b.width && i.height <= b.height) { i.height = i.height * b.width / i.width; i.width = b.width } else { if (i.width <= b.width && i.height > b.height) { i.width = i.width * b.height / i.height; i.height = b.height } else { if (i.width > b.width && i.height > b.height) { if (i.height / b.height > i.width / b.width) { i.width = i.width * b.height / i.height; i.height = b.height } else { i.height = i.height * b.width / i.width; i.width = b.width } } } } h.css({ width: i.width, height: i.height, top: (b.height / 2 - i.height / 2), visibility: "visible" }) }); h.attr("src", h.attr("data-src")) } f.find(".ui_imagegallery_navigator").html(parseInt(a.currPageX) + 1 + "/" + g.length) } }); var c = function (k) { if (k == 1 && f.is(":hidden")) { return } b = { width: $.browserSize().width, height: $.browserSize().height - 98 }; e.empty(); var l = null; for (var j = 0; j < g.length; j++) { l = $("<li>").addClass("ui_imagegallery_imgitem").css({ width: b.width, height: b.height }); $("<img>").attr({ src: $.getStaticSrcPath("images/loader.gif"), "data-src": $(g[j]).attr("data-raw"), "data-index": j }).appendTo(l); l.appendTo(e) } e.css({ width: g.length * b.width, height: b.height }); d.css({ width: b.width, height: b.height }); f.show(); if ($.platform.isIOS4) { var h = $(window).scrollTop(); f.css("top", h); f.css("height", $.browserSize().height) } a.refresh(); a.scrollToPage(f.attr("currentPage"), 0, 0) }; g.click(function () { f.attr("currentPage", $(this).attr("data-index")); c(0) }); if ($.platform.isIphoneOS) { $(window).bind("orientationchange", function () { c(1) }) } else { $(window).bind("orientationchange", function () { setTimeout(function () { c(1) }, 500) }) } f.find(".ui_imagegallery_back").click(function () { f.hide() }) } });